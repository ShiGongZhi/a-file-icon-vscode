# Atom Material Icons + Jetbrains Icons 插件开发、调试和发布流程

本文档详细介绍了 VS Code 插件 "Atom Material Icons + Jetbrains Icons" 的完整开发、调试和发布流程。

## 🛠️ 开发环境准备

### 必要工具

- **Node.js** (建议 v18+)
- **Bun** (用于包管理和构建)
- **Visual Studio Code**
- **Git**

### 依赖安装

```bash
# 安装项目依赖
bun install

# 全局安装 VS Code Extension 管理工具
npm install -g @vscode/vsce
```

## 📂 项目结构概览

```
a-file-icon-vscode/
├── src/                        # 源代码目录
│   ├── extension.ts           # 插件入口文件
│   ├── commands/              # 命令处理
│   ├── icons/                 # 图标配置
│   ├── helpers/               # 辅助工具
│   └── i18n/                  # 国际化
├── assets/                    # 图标资源
├── dist/                      # 编译输出目录
├── package.json               # 插件配置文件
├── .vscode/launch.json        # 调试配置
└── build/                     # 构建配置
```

## 🔧 开发流程

### 1. 修改代码

根据需求修改相应的源代码文件：

- **图标配置**: `src/icons/`
- **命令逻辑**: `src/commands/`
- **插件配置**: `package.json`

### 2. 构建项目

```bash
# 开发模式构建
bun run build

# 生产模式构建
bun run compile

# Web 扩展构建
bun run compile-web

# 监听模式（开发时推荐）
bun run compile:watch
```

### 3. 代码检查

```bash
# 运行 ESLint 检查
bun run lint

# 运行图标检查
bun run check
```

## 🐛 调试流程

### 方法一：使用 VS Code 调试器（推荐）

1. **启动调试**：
   - 打开 VS Code
   - 按 `F5` 或点击运行面板中的 "Launch Extension"
   - 会自动执行 `npm: build` 任务并启动新的 VS Code 窗口

2. **调试配置说明**：
   - **Launch Extension**: 启动桌面版扩展调试
   - **Run Web Extension in VS Code**: 启动 Web 版扩展调试
   - **Launch Tests**: 运行测试

3. **调试技巧**：
   - 在源代码中设置断点
   - 使用 `console.log()` 输出调试信息
   - 在调试控制台查看变量值

### 方法二：手动构建调试

```bash
# 1. 构建项目
bun run build

# 2. 在 VS Code 中按 Ctrl+Shift+P 打开命令面板
# 3. 输入 "Developer: Reload Window" 重新加载窗口
# 4. 或者重启 VS Code 应用设置更改
```

### 调试 Web 扩展

```bash
# 启动 Web 扩展监听模式
bun run watch-web

# 然后使用 "Run Web Extension in VS Code" 调试配置
```

## 🧪 测试流程

### 运行测试

```bash
# 预构建测试
bun run pretest

# 运行所有测试
bun run test
```

### 手动测试清单

- [ ] 插件正确加载和激活
- [ ] 文件图标正确显示
- [ ] 文件夹图标正确显示
- [ ] 命令面板功能正常
- [ ] 配置项生效
- [ ] 国际化正常工作

## 📋 发布前检查

### 1. 版本管理

```bash
# 更新版本号（package.json）
# 生成变更日志
bun run version
```

### 2. 完整构建和验证

```bash
# 运行完整的发布前构建
bun run vscode:prepublish

# 这个命令会执行：
# - bun run lint      (代码检查)
# - bun run compile   (生产构建)
# - bun run package-web (Web扩展打包)
```

### 3. 本地打包测试

```bash
# 生成 .vsix 安装包
vsce package

# 或使用 yarn 版本
bun run vsce
```

### 4. 本地安装测试

```bash
# 安装本地打包的扩展
code --install-extension atom-file-icon-with-jetbrains-x.x.x.vsix
```

## 🚀 发布流程

### 发布到 VS Code Marketplace

#### 1. 获取发布令牌

- 访问 [Azure DevOps](https://dev.azure.com/)
- 创建个人访问令牌 (PAT)
- 权限设置为 "Marketplace (publish)"

#### 2. 登录 vsce

```bash
# 登录到 marketplace
vsce login [publisher-name]
# 输入之前获取的 PAT
```

#### 3. 发布扩展

```bash
# 发布新版本
vsce publish

# 或指定版本类型
vsce publish patch    # 补丁版本 (x.x.1)
vsce publish minor    # 小版本 (x.1.0)
vsce publish major    # 大版本 (1.0.0)

# 或指定具体版本
vsce publish 1.2.3
```

### 发布到 Open VSX Registry（可选）

```bash
# 安装 ovsx
npm install -g ovsx

# 登录
ovsx login [registry-url]

# 发布
ovsx publish atom-file-icon-with-jetbrains-x.x.x.vsix
```

## 📁 重要文件说明

### package.json 关键配置

- **name**: 扩展唯一标识符
- **publisher**: 发布者名称
- **version**: 版本号
- **engines.vscode**: 支持的 VS Code 版本
- **contributes**: 扩展贡献点（图标主题、命令等）

### .vscode/launch.json

调试配置文件，定义了不同的调试场景：

- 桌面版扩展调试
- Web 版扩展调试
- 测试运行

## 🔄 自动化工作流程

### 推荐的开发工作流程

1. **开发阶段**：

   ```bash
   # 启动监听模式
   bun run compile:watch

   # 在另一个终端启动调试
   # 按 F5 启动 VS Code 调试
   ```

2. **提交前检查**：

   ```bash
   bun run lint           # 代码检查
   bun run build          # 构建验证
   bun run test           # 运行测试
   ```

3. **发布流程**：

   ```bash
   # 更新版本
   npm version patch

   # 完整构建
   bun run vscode:prepublish

   # 本地测试
   vsce package

   # 发布
   vsce publish
   ```

## 🛠️ 常用脚本说明

| 脚本            | 功能                   |
| --------------- | ---------------------- |
| `build`         | 开发构建（包含后处理） |
| `compile`       | 生产构建               |
| `compile:dev`   | 开发模式编译           |
| `compile:watch` | 监听模式编译           |
| `compile-web`   | Web 扩展编译           |
| `lint`          | ESLint 代码检查        |
| `check`         | 图标完整性检查         |
| `generateJson`  | 生成图标 JSON 配置     |
| `test`          | 运行测试               |
| `vsce`          | 打包扩展               |

## 🐞 常见问题排查

### 1. 构建失败

- 检查 Node.js 和 Bun 版本
- 清理 `node_modules` 重新安装依赖
- 检查 TypeScript 配置

### 2. 调试无法启动

- 确保已运行 `bun run build`
- 检查 `.vscode/launch.json` 配置
- 查看 VS Code 输出面板错误信息

### 3. 图标不显示

- 运行 `bun run generateJson` 重新生成配置
- 检查图标文件路径
- 验证 `package.json` 中的图标主题配置

### 4. 发布失败

- 检查 vsce 登录状态
- 验证 package.json 配置完整性
- 确保版本号正确递增

## 📝 注意事项

1. **版本控制**: 每次发布前务必更新版本号
2. **测试覆盖**: 在不同的项目类型中测试插件功能
3. **文档更新**: 重大更改时更新 README.md 和 CHANGELOG.md
4. **国际化**: 添加新功能时考虑多语言支持
5. **性能**: 监控插件对 VS Code 启动时间的影响

---

## 📚 相关资源

- [VS Code 扩展开发文档](https://code.visualstudio.com/api)
- [vsce 发布工具文档](https://github.com/microsoft/vscode-vsce)
- [VS Code Marketplace](https://marketplace.visualstudio.com/)
- [扩展开发最佳实践](https://code.visualstudio.com/api/references/extension-guidelines)
